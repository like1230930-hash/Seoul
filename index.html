<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#1E293B" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Seoul 2025 Ski Trip</title>
    
    <!-- Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet" />
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { 
              sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
              mono: ['JetBrains Mono', 'ui-monospace', 'monospace']
            },
            colors: {
              primary: '#1E293B',
              'bg-page': '#F2FAFC',
              'naver-green': '#03C75A',
              exit: '#F59E0B',
            }
          },
        },
      }
    </script>
    <style>
      :root {
        --sab: env(safe-area-inset-bottom);
        --sat: env(safe-area-inset-top);
      }
      
      body { 
        background-color: #F2FAFC; 
        -webkit-tap-highlight-color: transparent; 
        font-family: 'Inter', 'Noto Sans TC', sans-serif;
        overscroll-behavior-y: none;
        padding-top: var(--sat);
      }

      .hide-scrollbar::-webkit-scrollbar { display: none; }
      .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      .bg-line-1 { background-color: #0052A4; }
      .bg-line-2 { background-color: #00A84D; }
      .bg-line-3 { background-color: #EF7C1C; }
      .bg-line-4 { background-color: #00A5DE; }
      .bg-line-5 { background-color: #996CAC; }
      .bg-line-6 { background-color: #CD7C2F; }
      .bg-line-arex { background-color: #0090D2; }
      .bg-line-walk { background-color: #94A3B8; }

      @keyframes fadeIn { 
        from { opacity: 0; transform: translateY(12px); } 
        to { opacity: 1; transform: translateY(0); } 
      }
      .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
      
      .transform-gpu {
        transform: translate3d(0,0,0);
        will-change: transform, opacity;
      }

      .active-scale:active {
        transform: scale(0.97);
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // --- CONSTANTS: TRIP_DATA ---
      const TRIP_DATA = {
        "2025-12-21": {
          title: "Day 1 / 抵達首爾",
          subtitle: "Airport to Cheongnyangni",
          weather: { t: "4°C", i: "fa-cloud-moon", tip: "微冷，建議穿著防風外套" },
          discovery: {
            title: "清涼里的老派浪漫",
            desc: "清涼里是通往江原道的鐵路樞紐。這裡有復古的傳統市場與深受在地人喜愛的美食。推薦去京東市場尋寶！",
            spots: [
              { name: "清涼里奶奶冷麵 (청량리 할머니냉면)", desc: "著名的超辣冷麵，在傳統市場巷弄內，是在地人的靈魂食物。" },
              { name: "京東市場星巴克1960", desc: "由 1960 年代廢棄老劇院改建，是首爾最具特色的概念店之一。" }
            ]
          },
          items: [
            { type: "flight", airline: "Scoot 酷航", code: "TR896", from: "TPE", fromCity: "台北桃園", fromTime: "18:15", fromTerm: "T1", to: "ICN", toCity: "首爾仁川", toTime: "21:45", toTerm: "T1", bag: "35kg", title: "Flight TR896" },
            { 
              type: "transport", time: "22:40", title: "機場前往清涼里", sub: "AREX + 地鐵1號線", tags: ["最快路線", "重要"], 
              desc: "入境後跟隨黃色文字「Airport Railroad」指標移動。請先在超商加值 T-money。", 
              tips: "AREX 直達車末班約 22:48，請務必把握時間。若趕不上，可改搭 6002 號機場巴士（末班約 23:30）前往清涼里站。" 
            },
            { type: "transit", title: "Transfer", from: "仁川機場 T1", to: "清涼里站", steps: [{ color: "bg-line-arex", name: "AREX", desc: "往 首爾站 (直達)", time: "43分鐘" }, { color: "bg-line-1", name: "1號線", desc: "首爾站轉乘 (搭乘6站)", time: "18分鐘" }] },
            { 
              type: "hotel", time: "00:10", title: "入住 Hotel The Designers", sub: "清涼里站 4號出口", 
              address: "226 Wangsan-ro, Dongdaemun-gu, Seoul", 
              mapQuery: "호텔더디자이너스청량리",
              tags: ["Agoda已付"], 
              exit: "4號出口", 
              desc: "飯店就在 4 號出口步行 2 分鐘處。樓下即有便利商店。",
              tips: "飯店提供免費瓶裝水。若不夠可至樓下 GS25 採買。建議先買好隔天早上的簡單輕食。" 
            },
            { type: "snack", title: "深夜補給 & 宵夜", items: [ { name: "GS25 便利商店", desc: "飯店大樓 1樓，可買必喝的香蕉牛奶與三角飯糰。" }, { name: "清涼里炸雞胡同", desc: "推薦「南原炸雞」，傳統市場風味，份量極大且酥脆。" }, { name: "布帳馬車 (路邊攤)", desc: "車站前廣場通常有熱呼呼的魚板湯與辣炒年糕，適合深夜取暖。" } ] }
          ]
        },
        "2025-12-22": {
          title: "Day 2 / 前往雪場",
          subtitle: "High 1 Resort",
          weather: { t: "-5°C", i: "fa-snowflake", tip: "極冷，請穿發熱衣+雪衣" },
          discovery: {
            title: "舍北與古汗的煤礦往事",
            desc: "這裡曾是韓國最重要的煤礦產地，如今轉型為滑雪與博弈觀光區。小鎮充滿了昭和與現代交織的懷舊氛圍。",
            spots: [
              { name: "舍北傳統市場 (사북전통시장)", desc: "火車站旁，有許多道地的煤礦工人餐廳，價格親民。" },
              { name: "江原樂園賭場 (Kangwon Land)", desc: "韓國唯一允許本國人進入的賭場，夜晚燈光非常燦爛。" }
            ]
          },
          items: [
            { type: "transport", time: "07:00", title: "集合 (切勿遲到)", sub: "清涼里站 Olive Young 前", tags: ["早起注意", "絕對準時"], tips: "7:25 火車準時發車。請預留時間買早餐在車上吃。" },
            { type: "transport", time: "07:25", title: "火車出發", sub: "前往舍北站 (Sabuk)", desc: "車程約 3.5 小時，可在車上補眠。沿途山景轉為雪景時非常震撼。", tags: ["車程 3.5hr"] },
            { type: "transport", time: "10:55", title: "抵達舍北站", desc: "Sabuk Station 轉乘度假村接駁車（或計程車）前往度假村。" },
            { type: "activity", time: "11:05", title: "抵達 High 1", sub: "Mountain Ski House", address: "265 High1-gil, Sabuk-eup, Jeongseon-gun", mapQuery: "하이원리조트 마운틴스키하우스" },
            { type: "activity", time: "11:10", title: "挑選滑雪衣", sub: "租借裝備", tags: ["租借"], desc: "挑選適合尺寸與喜歡的配色。請務必檢查口袋拉鍊與魔鬼氈是否正常。" },
            { 
              type: "activity", time: "12:30", title: "領取硬體 & 付尾款", sub: "Ski House", 
              desc: "領取滑雪板、雪鞋。**需以現金支付教練尾款**。", 
              tags: ["準備現金", "重要"], 
              tips: "需要 500 韓元硬幣使用置物櫃，可在 Ski House 換幣機兌換。" 
            },
            { 
              type: "activity", time: "12:50", title: "滑雪課程開始", sub: "Day 1 基礎教學", 
              tags: ["教學 3hr"], 
              desc: "學習重點：正確穿脫裝備、安全跌倒與站起、基礎煞車 (Pizza 煞)。" 
            },
            { type: "hotel", time: "16:30", title: "入住 Ski House", sub: "Check-in", desc: "進房放行李、稍作休息。舒緩腿部肌肉。", mapQuery: "하이원리조트 마운틴콘도" },
            { type: "activity", time: "18:30", title: "夜間滑雪", sub: "Night Ski", tags: ["自由練習"], desc: "夜間雪場光線極佳，人較少，適合練習基礎動作與拍照。" },
            { type: "snack", title: "深夜補給 & 宵夜", items: [ { name: "Condo 便利商店", desc: "買泡麵、啤酒、飲料。韓國泡麵配雪景是最高享受。" }, { name: "外送炸雞", desc: "推薦 Pelicana 或 Mexicana，需在 Condo 大廳取貨。" } ] }
          ]
        },
        "2025-12-23": {
          title: "Day 3 / 全日滑雪",
          subtitle: "Ski & Relax",
          weather: { t: "-8°C", i: "fa-snowflake", tip: "山頂風大，務必戴護目鏡" },
          discovery: {
            title: "雪嶺巔峰與星空宵夜",
            desc: "High 1 以其優質的粉雪與多樣化的滑雪道聞名。除了滑雪，山頂的建築與自然景觀也是一大看點。",
            spots: [
              { name: "Top of the Top 旋轉餐廳", desc: "海拔 1340 公尺，每小時旋轉一圈，可飽覽江原道群山雪景。" },
              { name: "古汗 18 街", desc: "充滿壁畫與獨特燈飾的小鎮街道，是近年熱門的拍照打卡點。" }
            ]
          },
          items: [
            { type: "activity", time: "09:00", title: "滑雪課程 Day 2", tags:["教學 3hr"], desc: "進階練習：重心轉移、S 型轉彎 (C-Turn) 基礎。教練會嘗試帶領大家從較高的緩坡滑下。" },
            { type: "activity", time: "12:00", title: "課程結束 & 午餐", sub: "自由用餐", desc: "Ski House 餐廳有豐富的韓式料理與炸豬排。" },
            { 
              type: "activity", time: "13:30", title: "Top of the Top", sub: "山頂旋轉咖啡廳", 
              desc: "海拔 1340m 山頂，360 度雪景。即使不滑雪也必搭纜車上來朝聖。", 
              tags:["必去", "拍照聖地"] 
            },
            { type: "activity", time: "18:30", title: "最後夜間滑雪", tags:["Night Ski"], desc: "把握最後在雪場滑行的機會。注意體力分配與保暖。" },
            { type: "snack", title: "深夜補給 & 宵夜", items: [ { name: "古汗市場湯飯", desc: "搭接駁車下山吃熱呼呼的血腸湯或豬肉湯飯。" }, { name: "韓式五花肉烤肉", desc: "古汗邑有很多比度假村內便宜且道地的傳統烤肉店。" } ] }
          ]
        },
        "2025-12-24": {
          title: "Day 4 / 返回首爾",
          subtitle: "Christmas Eve",
          weather: { t: "-2°C", i: "fa-tree", tip: "平安夜人多，注意保暖" },
          discovery: {
            title: "平安夜的繁華與寧靜",
            desc: "首爾的平安夜充滿浪漫氣息，從明洞的繽紛燈海到上水洞的文青巷弄，能感受截然不同的氛圍。",
            spots: [
              { name: "明洞聖堂", desc: "韓國天主教的象徵，聖誕節當晚有美麗的燈光裝飾與彌撒，氛圍肅穆且浪漫。" },
              { name: "上水洞咖啡街", desc: "遠離弘大的喧囂，巷弄內藏著許多高質感的餐酒館與特色咖啡店。" }
            ]
          },
          items: [
            { type: "hotel", time: "08:20", title: "整理行李 & 退房", tags:["退房"] },
            { type: "activity", time: "15:45", title: "歸還裝備 & 集合", sub: "Mountain Ski House", tags:["集合"], tips: "請確認所有租借物品皆已歸還，並領回押金/證件。" },
            { type: "transport", time: "16:20", title: "巴士回首爾", desc: "直達巴士返回首爾，預計抵達明洞站。車程約 3.5 小時。", tags:["回程"] },
            { type: "transport", time: "19:45", title: "抵達 明洞站", desc: "感受平安夜的首爾街頭氣氛。步行前往餐廳。" },
            { 
              type: "food", time: "20:15", title: "晚餐：軍子大韓烤腸", sub: "明洞店", 
              desc: "<b>華莎同款！</b> 著名的火焰秀烤腸表演。必點：綜合烤腸。最後一定要點『大韓炒飯』！", 
              tags: ["平安夜大餐", "必吃", "火燒秀"], 
              naverLink: "https://map.naver.com/v5/search/군자대한곱창%20명洞점" 
            },
            { type: "list", time: "21:30", title: "明洞聖誕購物", list: ["<b>Olive Young</b> 旗艦店 (聖誕限定折扣)", "<b>NyuNyu</b> 明洞店 (飾品天堂)", "<b>Hemeko</b> (質感美妝選物)"], tags:["購物"] },
            { 
              type: "transit", title: "前往 Airbnb", from: "明洞", to: "上水站", 
              steps: [{ color: "bg-line-2", name: "2號線", desc: "乙支路入口 ➜ 合井" }, { color: "bg-line-6", name: "6號線", desc: "合井 ➜ 上水站", exit: "3號出口" }] 
            },
            { type: "hotel", time: "23:45", title: "入住 Airbnb", sub: "Host: Dada", address: "52 Tojeong-ro 11-gil, Mapo-gu, Seoul", exit: "3號出口", tips: "請確認房東提供的密碼鎖。進屋後請開啟地熱設備。" },
            { type: "snack", title: "深夜補給 & 宵夜", items: [ { name: "BHC 炸雞", desc: "推薦：黃金橄欖油炸雞或起司口味。" }, { name: "CU 便利商店", desc: "買些氣泡水、牛奶與韓國特色小零食。" } ] }
          ]
        },
        "2025-12-25": { 
          title: "Day 5 / 聖誕快樂", 
          subtitle: "Seongsu Fashion Tour", 
          weather: { t: "0°C", i: "fa-gift", tip: "聖水洞熱門店位需排隊" },
          discovery: {
            title: "聖水洞：首爾的布魯克林",
            desc: "原本是手工鞋廠林立的工業區，現已轉型為藝術家與潮流品牌聚集的時尚聖地。這裡的每棟建築都有其獨特的靈魂。",
            spots: [
              { name: "大林倉庫 (Daelim Changgo)", desc: "聖水洞代表性的藝文空間，將舊倉庫改造成咖啡廳、藝廊與餐飲場所。" },
              { name: "聖水洞手工鞋街", desc: "保留了傳統手工藝的歷史軌跡，隱藏著許多充滿匠人精神的小型工作室。" }
            ]
          },
          items: [
            { type: "transit", title: "前往聖水洞", from: "上水站", to: "聖水站", steps: [{ color: "bg-line-6", name: "6號線", desc: "上水 ➜ 合井" }, { color: "bg-line-2", name: "2號線", desc: "合井 ➜ 聖水站" }] },
            { 
              type: "food", time: "12:30", title: "午餐：南紅本家一隻雞", sub: "聖水店", exit: "4號出口",
              desc: "在地人強推！湯頭鮮甜，雞肉軟嫩。必加『刀切麵』與最後的『雞蛋粥』。", 
              naverLink: "https://map.naver.com/v5/search/남다른본가닭한마리%20성수점",
              tags: ["暖胃首選", "聖水必吃"] 
            },
            { 
              type: "list", time: "14:00", title: "聖水東側：經典與潮牌", sub: "聖水站周邊", 
              list: [
                "<b>Onion Seongsu</b> (廢墟風工業咖啡)",
                "<b>自然島鹽麵包</b> (招牌鹽麵包必買)",
                "<b>Musinsa Store</b> (大林倉庫潮流店)",
                "<b>New Balance</b> (聖水旗艦店)",
                "<b>Rockfish Weatherwear</b> (質感英倫雨鞋/服飾)",
                "<b>NyuNyu</b> (聖水飾品大本營)",
                "<b>Matin Kim</b> (當紅人氣服飾品牌)",
                "<b>Rolarola</b> (可愛風少女服飾)",
                "<b>Beaker</b> (高端質感選物店)"
              ],
              tags:["時尚潮流", "必逛"] 
            },
            { 
              type: "list", time: "15:30", title: "聖水中央：香氛與美學", sub: "演武場街核心", 
              list: [
                "<b>Point of View</b> (精品文具界的天花板)",
                "<b>Tamburins</b> (Jennie 專屬香氛空間)",
                "<b>Nonfiction</b> (韓國小眾香氛洗護)",
                "<b>Kinfolk Notes</b> (簡約質感香氛)",
                "<b>SW19</b> (以一天不同時刻命名的香氛)",
                "<b>Ader Error</b> (太空實驗室概念設計)",
                "<b>emis</b> (爆紅帽子、包包品牌)",
                "<b>BADBLOOD</b> (歐美辣妹風潮流服飾)",
                "<b>TETO</b> (彩色質感毛巾專門店)",
                "<b>MUUT</b> (極簡風格眼鏡店)"
              ],
              tags:["美學空間", "香氛"] 
            },
            { 
              type: "list", time: "17:00", title: "聖水西側：精選與美妝", sub: "纛島站方向", 
              list: [
                "<b>Mardi Mercredi</b> (經典小雛菊系列)",
                "<b>fwee Agit</b> (爆紅布丁唇釉美妝)",
                "<b>Poset</b> (明信片圖書館)",
                "<b>BriBeet</b> (西式精緻輕食)",
                "<b>Fogsu</b> (質感小眾選物服飾)",
                "<b>KHIHO</b> (工業概念店)",
                "<b>Olive Young</b> (聖水站最後補貨)"
              ],
              tags:["必買名單", "美妝"] 
            },
            { 
              type: "food", time: "19:00", title: "晚餐：馬場洞韓牛大餐", sub: "馬場站 2號出口",
              desc: "聖誕韓牛饗宴！現選現切現烤。推薦：『雪花里脊』與『橫隔膜肉』。", 
              naverLink: "https://map.naver.com/v5/search/마장축산물시장",
              tags: ["韓牛", "聖誕大餐", "1++等級"] 
            },
            { type: "activity", time: "21:00", title: "東大門夜遊", desc: "DDP 玫瑰燈海/夜景、NyuNyu 飾品總店（深夜不打烊）。" },
            { type: "snack", title: "聖誕深夜補給", items: [ { name: "푸拉닭 (Puradak Chicken)", desc: "聖誕節首選！像精品包一樣的包裝，大推『黑蒜口味 (Black Alio)』，外酥內嫩口感絕佳。" }, { name: "東大門獵奇辣炒年糕", desc: "感受一下總店的魔鬼辣度. 聖誕夜的極限重口味補給。" } ] }
          ] 
        },
        "2025-12-26": { 
          title: "Day 6 / 懷舊首爾", 
          subtitle: "Bukchon & Ikseon", 
          weather: { t: "2°C", i: "fa-camera", tip: "穿著舒適好走的鞋子" }, 
          discovery: {
            title: "穿越時空的韓屋漫步",
            desc: "首爾的舊城區保留了珍貴的傳統韓屋，結合了現代咖啡館與選物店，是新舊並存的最佳體現。",
            spots: [
              { name: "益善洞迷宮", desc: "窄小的巷弄內佈滿了由韓屋改造的特色店鋪，每轉一個彎都有驚喜。" },
              { name: "西村（孝子洞）", desc: "比起熱鬧的北村，西村更顯安靜文雅，是許多文青熱愛的散步路線。" }
            ]
          },
          items: [
            { type: "food", time: "10:30", title: "Artist Bakery", sub: "安國站 1號出口", tags: ["鹽麵包"], desc: "倫敦貝果姐妹店。必吃：原味或奶油鹽麵包。" },
            { type: "activity", time: "11:30", title: "北村韓屋村", tags: ["拍照"], desc: "歷史悠久的韓屋聚落。請保持安靜，勿打擾居民。" },
            { type: "food", time: "13:30", title: "午餐：土俗村蔘雞湯", tags: ["必吃"], desc: "首爾最經典的蔘雞湯。濃郁人蔘與飽滿糯米。" },
            { type: "list", time: "15:00", title: "西村文青散策", list: ["<b>Granhand</b> (香氛)", "<b>Ofr Seoul</b> (選物店)", "<b>Scoff</b> (司康)"], tags: ["文青必訪"] },
            { type: "list", time: "17:30", title: "益善洞迷宮", list: ["<b>清水堂</b> (絕美燈籠)", "<b>小夏鹽田</b>", "<b>樂園驛</b>"], tags: ["復古浪漫"] },
            { type: "snack", title: "最後的首爾宵夜", items: [ { name: "60계치킨 (60-gye Chicken)", desc: "每天只用新油炸 60 隻雞的名店。推薦：椒鹽口味或清甜的虎蘭口味。" }, { name: "上水洞居酒屋", desc: "Airbnb 附近最後的小酌時光。感受首爾深夜的感性。" } ] }
          ] 
        },
        "2025-12-27": {
          title: "Day 7 / 滿載而歸", 
          subtitle: "Bye Seoul", 
          weather: { t: "3°C", i: "fa-plane" },
          discovery: {
            title: "首爾最後巡禮",
            desc: "在回程前再次感受首爾的繁華與優雅。從交通樞紐首爾站到文青貴氣的漢南洞，為旅程畫下完美句點。",
            spots: [
              { name: "首爾站屋頂花園", desc: "俯瞰首爾站繁忙的鐵道景象與空中步道 7017，是極佳的城市視野。" },
              { name: "漢南洞精品街", desc: "韓國設計師品牌的聚集地，適合在離開前進行最後的高質感購物。" }
            ]
          },
          items: [
            { type: "activity", time: "11:40", title: "首爾站：寄放行李", tags: ["重要"], desc: "利用 Lotte Mart 或車站 T-Luggage 服務。" },
            { type: "food", time: "12:30", title: "午餐：Sosiniso (소신이쏘)", sub: "新村站", desc: "奶油燉排骨名店。必點：奶油牛肉排骨。", tags: ["排隊名店"] },
            { type: "shopping", time: "14:30", title: "Perfumery Blute", sub: "漢南店", tags: ["漢南洞", "香氛"], desc: "極具設計感的紅磚屋香氛空間。" },
            { type: "shopping", time: "16:00", title: "樂天超市採買", sub: "首爾站店", desc: "最後伴手禮大採購。滿額現場退稅。", tags: ["必買", "退稅"] },
            { type: "flight", airline: "Scoot 酷航", code: "TR897", from: "ICN", fromTime: "23:00", fromTerm: "T1", to: "TPE", toTime: "00:45", toTerm: "T1", bag: "50kg", title: "Flight TR897" }
          ]
        }
      };

      const PHRASES = [
        { k: "안녕하세요", p: "An-nyeong-ha-se-yo", m: "你好 (Hello)" },
        { k: "감사합니다", p: "Gam-sa-ham-ni-da", m: "謝謝 (Thank you)" },
        { k: "얼마예요?", p: "Eol-ma-ye-yo?", m: "多少錢? (How much?)" },
        { k: "화장실 어디예요?", p: "Hwa-jang-sil eo-di-ye-yo?", m: "廁所在哪? (Where is toilet?)" },
        { k: "이거 주세요", p: "I-geo ju-se-yo", m: "請給我這個 (This one please)" },
        { k: "물 주세요", p: "Mul ju-se-yo", m: "請給我水 (Water please)" },
        { k: "영수증 주세요", p: "Yeong-su-jeung ju-se-yo", m: "請給我收據 (Receipt please)" },
        { k: "맛있어요", p: "Ma-si-sseo-yo", m: "好吃 (Delicious)" }
      ];

      const INITIAL_CHECKLIST = [
        { title: "證件與錢財", items: ["護照 (檢查效期 >6個月)", "機票 (電子/紙本)", "現金 (韓幣)", "信用卡 (海外回饋高的)", "旅遊保險單"] }, 
        { title: "滑雪裝備", items: ["保暖長襪 (厚實多雙)", "發熱衣褲 (排汗兩套)", "防水滑雪手套", "毛帽 (需遮耳)", "圍脖/脖圍 (防風)"] }, 
        { title: "電子用品", items: ["轉接頭 (韓國圓孔插座)", "行動電源", "充電線材組", "SIM卡/漫遊已開通"] }, 
        { title: "個人物品", items: ["私人藥物", "保濕乳液/護唇膏 (極乾)"] }
      ];

      // --- COMPONENTS ---

      const NaverButton = ({ url, query, address }) => {
        const finalUrl = url || (query || address ? `https://map.naver.com/v5/search/${encodeURIComponent(query || address || '')}` : null);
        if (!finalUrl) return null;
        return (
          <a href={finalUrl} target="_blank" rel="noreferrer" className="flex items-center justify-center bg-[#03C75A] text-white font-bold rounded-2xl p-4 mt-4 text-sm w-full active:scale-95 transition-transform shadow-md transform-gpu">
            <span className="font-black text-xl mr-2 font-serif leading-none">N</span> 開啟 Naver Map 導航
          </a>
        );
      };

      const TagPill = ({ text }) => {
        let colorClass = "bg-slate-100 text-slate-600 border-slate-200";
        if (text.includes("必") || text.includes("租") || text.includes("金") || text.includes("付")) {
          colorClass = "bg-orange-50 text-orange-700 border-orange-100";
        } else if (text.includes("重") || text.includes("準時") || text.includes("教") || text.includes("車")) {
          colorClass = "bg-blue-50 text-blue-700 border-blue-100";
        } else if (text.includes("吃") || text.includes("大餐") || text.includes("美食")) {
          colorClass = "bg-rose-50 text-rose-700 border-rose-100";
        }
        return <span className={`inline-flex items-center px-2 py-0.5 rounded-lg text-[10px] font-bold mr-1.5 mb-1.5 border ${colorClass} leading-none uppercase tracking-wider`}>{text}</span>;
      };

      const BoardingPass = ({ item }) => (
        <div className="bg-white rounded-[32px] shadow-lg mb-6 border border-slate-200 overflow-hidden transform-gpu animate-fade-in">
          <div className="px-6 py-3 bg-slate-50/50 border-b border-slate-100 flex justify-between items-center">
            <span className="text-[10px] font-black tracking-[0.2em] text-slate-400 uppercase">Boarding Pass</span>
            <div className="flex items-center gap-2 text-slate-800"><i className="fas fa-plane text-xs"></i><span className="font-black text-[10px] uppercase">{item.airline}</span></div>
          </div>
          <div className="p-6">
            <div className="flex justify-between items-end mb-6">
              <div className="min-w-0">
                <div className="text-4xl font-black text-slate-900 font-mono tracking-tighter leading-none">{item.from}</div>
                <div className="text-[10px] text-slate-500 font-bold mt-2 bg-slate-100 px-2 py-0.5 rounded uppercase inline-block max-w-full truncate">{item.fromCity} {item.fromTerm && <span className="text-blue-600 ml-1">[{item.fromTerm}]</span>}</div>
              </div>
              <div className="flex-1 flex flex-col items-center px-4 pb-1">
                <div className="text-[10px] font-mono font-black text-blue-600 mb-2">{item.code}</div>
                <div className="w-full h-[2px] bg-slate-100 relative">
                  <div className="absolute right-0 -top-[3px] w-2 h-2 bg-slate-200 rounded-full"></div>
                  <i className="fas fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-200 text-[10px] transform rotate-90"></i>
                </div>
              </div>
              <div className="text-right min-w-0">
                <div className="text-4xl font-black text-blue-600 font-mono tracking-tighter leading-none">{item.to}</div>
                <div className="text-[10px] text-slate-500 font-bold mt-2 bg-slate-100 px-2 py-0.5 rounded uppercase inline-block max-w-full truncate">{item.toCity} {item.toTerm && <span className="text-blue-600 ml-1">[{item.toTerm}]</span>}</div>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-4 pt-5 border-t border-dashed border-slate-200 mb-4">
              <div><div className="text-[9px] text-slate-400 uppercase font-black mb-1 tracking-widest">Departure</div><div className="text-xl font-bold text-slate-800 font-mono leading-none">{item.fromTime}</div></div>
              <div className="text-right"><div className="text-[9px] text-slate-400 uppercase font-black mb-1 tracking-widest">Arrival</div><div className="text-xl font-bold text-blue-600 font-mono leading-none">{item.toTime}</div></div>
            </div>
            {item.bag && <div className="bg-blue-50/50 rounded-xl p-3 flex items-center justify-between border border-blue-100/50"><span className="text-[10px] font-black text-blue-400 tracking-widest uppercase">Baggage Allowance</span><span className="text-sm font-black text-blue-700">{item.bag}</span></div>}
          </div>
        </div>
      );

      const SnackCard = ({ item }) => (
        <div className="bg-slate-900 text-slate-200 rounded-[32px] p-7 mb-6 shadow-2xl relative overflow-hidden transform-gpu animate-fade-in">
          <div className="text-[10px] font-black text-blue-400 uppercase tracking-[0.3em] mb-5 flex items-center"><i className="fas fa-moon mr-2"></i> {item.title || '深夜補給'}</div>
          <div className="space-y-4">
            {item.items?.map((s, idx) => {
              const name = typeof s === 'string' ? s : s.name;
              const desc = typeof s === 'string' ? '' : s.desc;
              return (
                <div key={idx} className="flex items-start bg-white/5 p-4 rounded-2xl border border-white/5">
                  <div className="w-8 h-8 rounded-xl bg-white/10 flex items-center justify-center mr-4 flex-shrink-0"><i className="fas fa-utensils text-blue-300 text-[10px]"></i></div>
                  <div className="flex-1 min-w-0"><div className="font-black text-white text-sm truncate">{name}</div>{desc && <div className="text-[11px] text-slate-400 mt-1 leading-relaxed">{desc}</div>}</div>
                </div>
              )
            })}
          </div>
        </div>
      );

      const TransitCard = ({ item }) => (
        <div className="bg-white border border-slate-200 rounded-[32px] p-7 mb-6 shadow-sm transform-gpu animate-fade-in">
          <div className="flex justify-between items-center mb-6 pb-4 border-b border-slate-50">
            <div className="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] flex items-center"><i className="fas fa-route mr-2 text-blue-500"></i> 交通轉乘</div>
            <div className="text-[11px] font-black text-slate-900 bg-slate-50 px-3 py-1 rounded-full border border-slate-100 flex items-center min-w-0 shadow-sm"><span className="truncate">{item.from}</span><i className="fas fa-chevron-right mx-2 text-slate-300 text-[8px] flex-shrink-0"></i><span className="truncate">{item.to}</span></div>
          </div>
          <div className="space-y-0 relative pl-1">
            {item.steps?.map((step, idx) => (
              <div key={idx} className="flex items-start relative pb-8 last:pb-0 group">
                {idx !== (item.steps?.length || 0) - 1 && <div className="absolute left-[9px] top-6 bottom-0 w-[2px] bg-slate-100 group-hover:bg-slate-200 transition-colors"></div>}
                <div className={`w-[20px] h-[20px] rounded-full z-10 flex-shrink-0 border-[4px] border-white shadow-sm mr-5 mt-1 ${!step.color ? 'bg-slate-300' : ''} ${step.color || ''} transition-transform group-hover:scale-110`}></div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1.5 flex-wrap"><span className={`text-[9px] font-black text-white px-2 py-0.5 rounded-md ${step.color || 'bg-slate-400'} uppercase tracking-tighter flex-shrink-0`}>{step.name}</span><span className="text-sm font-black text-slate-900 truncate leading-tight">{step.desc}</span></div>
                  <div className="flex items-center gap-3">{step.exit && <span className="inline-flex items-center bg-amber-500 text-white text-[9px] font-black px-2 py-0.5 rounded-full shadow-sm">出口 {step.exit}</span>}{step.time && <div className="text-[10px] text-slate-400 font-bold uppercase"><i className="far fa-clock mr-1"></i>約 {step.time}</div>}</div>
                </div>
              </div>
            ))}
          </div>
          <NaverButton url={item.naverLink} query={item.mapQuery} address={item.address} />
        </div>
      );

      const ListCard = ({ item }) => (
        <div className="bg-white rounded-[32px] p-7 mb-6 shadow-sm border border-slate-100 transform-gpu animate-fade-in">
          <div className="flex justify-between items-start mb-5"><div className="text-[11px] font-black font-mono text-slate-400 bg-slate-50 px-3 py-1 rounded-full border border-slate-100">{item.time}</div><div className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{item.sub || item.subtitle}</div></div>
          <h3 className="text-xl font-black text-slate-900 leading-tight mb-5 tracking-tight">{item.title}</h3>
          <div className="space-y-4 mb-6">{item.list?.map((li, idx) => (<div key={idx} className="flex items-start text-sm text-slate-700 relative pl-6 leading-relaxed"><span className="absolute left-0 top-2.5 w-1.5 h-1.5 rounded-full bg-blue-500/30"></span><span className="font-medium" dangerouslySetInnerHTML={{__html: li}}></span></div>))}</div>
          <div className="flex flex-wrap gap-1">{item.tags?.map((tag, idx) => <TagPill key={idx} text={tag} />)}</div>
          <NaverButton url={item.naverLink} query={item.mapQuery} address={item.address} />
        </div>
      );

      const StandardCard = ({ item }) => {
        const iconMap = { transport: "fa-train-subway", hotel: "fa-bed", food: "fa-utensils", shopping: "fa-bag-shopping", activity: "fa-person-skiing" };
        const colorMap = { transport: "text-blue-500", hotel: "text-purple-500", food: "text-rose-500", shopping: "text-pink-500", activity: "text-cyan-500" };
        const icon = iconMap[item.type] || "fa-circle";
        const iconColor = colorMap[item.type] || "text-slate-500";
        return (
          <div className="bg-white rounded-[32px] p-7 mb-6 shadow-sm border border-slate-100 active:scale-[0.98] transition-transform transform-gpu animate-fade-in">
            <div className="flex items-start gap-5">
              <div className={`w-14 h-14 rounded-[22px] bg-slate-50 flex items-center justify-center text-2xl ${iconColor} border border-slate-100 flex-shrink-0 shadow-inner`}><i className={`fas ${icon}`}></i></div>
              <div className="flex-1 min-w-0">
                <div className="flex justify-between items-center mb-1"><div className="text-[11px] font-mono font-black text-slate-400 tracking-wider">{item.time}</div>{item.exit && <span className="inline-flex items-center bg-amber-500 text-white text-[9px] font-black px-2 py-0.5 rounded-full shadow-sm">出口 {item.exit}</span>}</div>
                <h3 className="text-xl font-black text-slate-900 leading-tight mb-1 truncate">{item.title}</h3>
                <div className="text-[11px] font-bold text-slate-400 mb-3 truncate">{item.sub || item.subtitle}</div>
                <div className="flex flex-wrap">{item.tags?.map((tag, idx) => <TagPill key={idx} text={tag} />)}</div>
              </div>
            </div>
            {(item.desc || item.tips) && (
              <div className="mt-6 pt-5 border-t border-slate-50">
                <div className="text-sm text-slate-600 leading-relaxed mb-4 font-medium" dangerouslySetInnerHTML={{__html: item.desc || ''}}></div>
                {item.tips && (<div className="text-[11px] font-bold text-amber-800 bg-amber-50 p-4 rounded-2xl border border-amber-100 flex items-start"><i className="fas fa-lightbulb mr-3 mt-0.5 text-amber-500"></i><span className="leading-relaxed">{item.tips}</span></div>)}
                <NaverButton url={item.naverLink} query={item.mapQuery} address={item.address} />
              </div>
            )}
          </div>
        );
      };

      const Header = ({ activeDate, setActiveDate }) => {
        const data = TRIP_DATA[activeDate];
        const [isCollapsed, setIsCollapsed] = useState(false);
        const lastScrollY = useRef(0);
        const ticking = useRef(false);

        useEffect(() => {
          const updateHeader = () => {
            const currentScrollY = Math.max(0, window.scrollY);
            const diff = currentScrollY - lastScrollY.current;
            if (Math.abs(diff) > 15) {
              if (currentScrollY > 120 && diff > 0) setIsCollapsed(true);
              else if (diff < -35 || currentScrollY <= 20) setIsCollapsed(false);
              lastScrollY.current = currentScrollY;
            }
            ticking.current = false;
          };
          const onScroll = () => { if (!ticking.current) { window.requestAnimationFrame(updateHeader); ticking.current = true; } };
          window.addEventListener('scroll', onScroll, { passive: true });
          return () => window.removeEventListener('scroll', onScroll);
        }, []);

        return (
          <div className="sticky top-0 z-40 bg-[#F2FAFC] transform-gpu">
            <div className="bg-[#F2FAFC]/90 backdrop-blur-xl border-b border-slate-200/50 px-6 pt-6 pb-4 relative z-50 shadow-sm">
              <div className="text-[9px] font-black text-blue-600 tracking-[0.4em] uppercase mb-1.5 opacity-80 leading-none">SEOUL SKI 2025</div>
              <div className="flex justify-between items-end">
                <div className="min-w-0 flex-1 mr-4"><h1 className="text-2xl font-black text-slate-900 leading-none tracking-tighter truncate transition-all duration-300">{data.title.split(' / ')[1] || data.title}</h1></div>
                <div className="flex flex-col items-end text-right flex-shrink-0"><div className="text-xl text-slate-700 leading-none"><i className={`fas ${data.weather.i}`}></i></div><div className="text-[10px] font-black text-slate-400 mt-1.5 uppercase leading-none">{data.weather.t}</div></div>
              </div>
            </div>
            <div className={`bg-[#F2FAFC]/95 backdrop-blur-md border-b border-slate-200/40 transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] transform-gpu origin-top overflow-hidden ${isCollapsed ? 'h-0 opacity-0 -translate-y-4 pointer-events-none' : 'h-[108px] opacity-100 translate-y-0'}`}>
              <div className="overflow-x-auto hide-scrollbar px-6 h-full flex items-center">
                <div className="flex flex-nowrap items-center min-w-max">
                  {Object.keys(TRIP_DATA).map((date, idx) => {
                    const isActive = date === activeDate;
                    const d = new Date(date);
                    return (
                      <button key={date} onClick={() => setActiveDate(date)} className={`flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-[24px] transition-all duration-300 border-2 ${idx === 0 ? 'mr-2' : 'mx-2'} ${isActive ? 'bg-slate-900 text-white shadow-xl scale-110 border-transparent z-10' : 'bg-white text-slate-400 border-slate-100 z-0 active:scale-95'}`}>
                        <span className={`text-[8px] uppercase font-black tracking-widest mb-1 ${isActive ? 'opacity-60' : 'opacity-40'}`}>{d.toLocaleDateString("en-US", { weekday: "short" })}</span>
                        <span className="text-xl font-black font-mono leading-none mb-1">{d.getDate()}</span>
                        <i className={`fas ${TRIP_DATA[date].weather.i} text-[8px] ${isActive ? 'opacity-100 text-blue-300' : 'opacity-0'}`}></i>
                      </button>
                    )
                  })}
                  <div className="w-8 flex-shrink-0" />
                </div>
              </div>
            </div>
          </div>
        );
      };

      const ItineraryView = ({ activeDate }) => {
        const dayData = TRIP_DATA[activeDate];
        return (
          <div className="pb-8 pt-4">
            {dayData.discovery && (
              <div className="bg-gradient-to-br from-slate-700 to-slate-800 text-white rounded-[24px] p-6 mb-6 shadow-xl relative overflow-hidden group">
                <div className="absolute -top-10 -right-10 w-48 h-48 bg-white/5 rounded-full blur-3xl pointer-events-none"></div>
                <div className="relative z-10">
                  <div className="text-xs font-bold text-blue-200 uppercase tracking-widest mb-2 flex items-center"><i className="fas fa-compass mr-2 animate-pulse"></i> 探索周邊</div>
                  <h3 className="text-2xl font-black mb-2">{dayData.discovery.title}</h3>
                  <p className="text-sm text-slate-300 leading-relaxed font-light mb-4">{dayData.discovery.desc}</p>
                  <div className="space-y-3">
                    {dayData.discovery.spots.map((s, i) => (
                      <div key={i} className="bg-white/10 rounded-xl p-3 backdrop-blur-sm border border-white/10 flex items-start">
                        <div className="w-8 h-8 rounded-full bg-blue-500/20 text-blue-200 flex items-center justify-center mr-3 flex-shrink-0 mt-0.5"><i className="fas fa-map-marker-alt text-xs"></i></div>
                        <div><div className="font-bold text-base text-white">{s.name}</div>{s.desc && <div className="text-xs text-slate-400 mt-0.5">{s.desc}</div>}</div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
            {dayData.items.map((item, idx) => {
              switch (item.type) {
                case 'flight': return <BoardingPass key={idx} item={item} />;
                case 'snack': return <SnackCard key={idx} item={item} />;
                case 'transit': return <TransitCard key={idx} item={item} />;
                case 'list': return <ListCard key={idx} item={item} />;
                default: return <StandardCard key={idx} item={item} />;
              }
            })}
          </div>
        );
      };

      const AccountingView = () => {
        const [expenses, setExpenses] = useState([]);
        const [name, setName] = useState('');
        const [amount, setAmount] = useState('');
        const [curr, setCurr] = useState('KRW');

        useEffect(() => {
          const saved = localStorage.getItem('ski_exp_final_v6');
          if (saved) { try { setExpenses(JSON.parse(saved)); } catch (e) { console.error(e); } }
        }, []);

        const save = (updated) => { setExpenses(updated); localStorage.setItem('ski_exp_final_v6', JSON.stringify(updated)); };
        const add = (who) => {
          if (!name || !amount) return;
          const exp = { id: Date.now(), i: name, a: amount, w: who, c: curr };
          save([...expenses, exp]); setName(''); setAmount('');
        };
        const remove = (id) => { if (window.confirm('確定刪除此筆記錄?')) save(expenses.filter(e => e.id !== id)); };

        const total = expenses.reduce((acc, e) => acc + parseInt(e.a || '0'), 0);
        const paidMe = expenses.filter(e => e.w === 'me').reduce((acc, e) => acc + parseInt(e.a || '0'), 0);
        const diff = paidMe - (total / 2);

        return (
          <div className="pb-10">
            <h2 className="text-3xl font-black text-slate-900 mb-6 px-2 tracking-tighter">分帳記帳</h2>
            <div className="bg-slate-900 text-white p-8 rounded-[40px] mb-8 shadow-2xl relative overflow-hidden">
              <div className="absolute -top-20 -right-20 w-64 h-64 bg-blue-500/20 rounded-full blur-[80px] pointer-events-none"></div>
              <div className="text-[10px] text-slate-400 font-black uppercase mb-2 tracking-[0.2em] z-10 relative">總支出 (₩)</div>
              <div className="text-5xl font-black mb-8 z-10 relative font-mono tracking-tighter">₩{total.toLocaleString()}</div>
              <div className={`text-center py-4 rounded-2xl text-sm font-black z-10 relative border transition-all ${diff > 0 ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20 shadow-[0_0_20px_rgba(16,185,129,0.1)]' : diff < 0 ? 'bg-blue-500/10 text-blue-400 border-blue-500/20 shadow-[0_0_20px_rgba(59,130,246,0.1)]' : 'bg-slate-500/10 text-slate-400 border-slate-700'}`}>
                {diff > 0 ? `對方 需給你 ₩${Math.abs(diff).toLocaleString()}` : diff < 0 ? `你 需給對方 ₩${Math.abs(diff).toLocaleString()}` : '金額已結清'}
              </div>
            </div>
            <div className="bg-white p-7 rounded-[32px] border border-slate-200 shadow-sm mb-8">
              <input value={name} onChange={e => setName(e.target.value)} placeholder="項目 (如: 烤腸)" className="w-full p-4 rounded-2xl bg-slate-50 mb-4 text-sm font-bold outline-none border-2 border-transparent focus:border-blue-500 transition-all" />
              <div className="flex gap-3 mb-6">
                <select value={curr} onChange={e => setCurr(e.target.value)} className="p-4 rounded-2xl bg-slate-50 text-sm font-black border-2 border-transparent outline-none cursor-pointer"><option value="KRW">₩ KRW</option><option value="TWD">NT$ TWD</option></select>
                <input type="number" value={amount} onChange={e => setAmount(e.target.value)} placeholder="金額" className="flex-1 p-4 rounded-2xl bg-slate-50 text-sm font-black outline-none border-2 border-transparent focus:border-blue-500 transition-all" />
              </div>
              <div className="flex gap-3"><button onClick={() => add('me')} className="flex-1 py-4 bg-slate-900 text-white rounded-2xl font-black text-sm active:scale-95 shadow-md">我先付</button><button onClick={() => add('cup')} className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-black text-sm active:scale-95 shadow-md">對方先付</button></div>
            </div>
            <div className="space-y-3">
              {expenses.slice().reverse().map(e => (
                <div key={e.id} className="flex justify-between items-center bg-white p-5 rounded-[24px] border border-slate-100 shadow-sm animate-fade-in">
                  <div className="flex items-center gap-4">
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xs font-black shadow-inner ${e.w === 'me' ? 'bg-slate-900 text-white' : 'bg-blue-100 text-blue-600'}`}>{e.w === 'me' ? '我' : '對'}</div>
                    <div><div className="font-black text-slate-800 text-sm">{e.i}</div><div className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5">{e.w === 'me' ? 'Paid by me' : 'Paid by Partner'}</div></div>
                  </div>
                  <div className="flex items-center gap-5"><div className="font-black text-slate-900 font-mono text-lg">{e.c === 'TWD' ? 'NT$' : '₩'}{parseInt(e.a).toLocaleString()}</div><button onClick={() => remove(e.id)} className="text-slate-200 hover:text-red-500 p-2"><i className="fas fa-times-circle text-lg"></i></button></div>
                </div>
              ))}
            </div>
          </div>
        );
      };

      const TranslationView = () => {
        const play = (text) => {
          if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ko-KR'; u.rate = 0.9; window.speechSynthesis.speak(u);
          }
        };
        return (
          <div className="pb-10 px-2 animate-fade-in">
            <h2 className="text-3xl font-black text-slate-900 mb-8 tracking-tighter">常用翻譯</h2>
            <div className="grid grid-cols-2 gap-4">
              {PHRASES.map((p, i) => (
                <button key={i} onClick={() => play(p.k)} className="bg-white p-5 rounded-[32px] border border-slate-200 text-center active:scale-95 transition-all min-h-[176px] flex flex-col justify-center items-center shadow-sm hover:border-blue-200 group w-full overflow-hidden">
                  <div className="text-xl font-black text-slate-800 mb-2 group-hover:text-blue-600 transition-colors break-words w-full leading-tight">{p.k}</div>
                  <div className="inline-block max-w-full"><div className="text-[9px] text-rose-500 font-black uppercase tracking-[0.1em] mb-3 bg-rose-50 px-3 py-1 rounded-full border border-rose-100 break-words leading-none">{p.p}</div></div>
                  <div className="text-sm text-slate-500 font-bold leading-snug break-words w-full">{p.m}</div>
                  <div className="mt-4 text-[9px] text-slate-300 font-black flex items-center gap-1 opacity-0 group-hover:opacity-100"><i className="fas fa-volume-up"></i> CLICK TO PLAY</div>
                </button>
              ))}
            </div>
          </div>
        );
      };

      const ToolsView = () => {
        const [rate, setRate] = useState(43);
        const [krw, setKrw] = useState('');
        const [tax, setTax] = useState('');
        const [checklist, setChecklist] = useState(INITIAL_CHECKLIST);
        const [checked, setChecked] = useState([]);
        const [newItem, setNewItem] = useState('');

        useEffect(() => {
          const savedRate = localStorage.getItem('ski_rate'); if (savedRate) setRate(parseFloat(savedRate));
          const savedList = localStorage.getItem('ski_checklist_data_v2'); if (savedList) setChecklist(JSON.parse(savedList));
          const savedChecked = localStorage.getItem('ski_checklist_checked_v2'); if (savedChecked) setChecked(JSON.parse(savedChecked));
        }, []);

        const updateList = (l) => { setChecklist(l); localStorage.setItem('ski_checklist_data_v2', JSON.stringify(l)); };
        const updateChecked = (c) => { setChecked(c); localStorage.setItem('ski_checklist_checked_v2', JSON.stringify(c)); };
        const toggle = (item) => checked.includes(item) ? updateChecked(checked.filter(i => i !== item)) : updateChecked([...checked, item]);
        const addItem = () => { if (!newItem.trim()) return; const newList = [...checklist]; let p = newList.find(g => g.title === "個人物品") || { title: "個人物品", items: [] }; if (!newList.find(g => g.title === "個人物品")) newList.push(p); p.items.push(newItem.trim()); updateList(newList); setNewItem(''); };
        const removeItem = (gi, ii) => { const newList = [...checklist]; newList[gi].items.splice(ii, 1); updateList(newList); };
        const calcTax = (val) => { const v = parseFloat(val); if (isNaN(v) || v < 30000) return 0; return Math.floor(v * 0.065); };

        return (
          <div className="pb-10 space-y-8 animate-fade-in px-2">
            <h2 className="text-3xl font-black text-slate-900 tracking-tighter">旅行工具</h2>
            <div className="bg-slate-900 text-white p-8 rounded-[40px] shadow-2xl relative overflow-hidden">
              <div className="absolute -bottom-10 -right-10 w-40 h-40 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none"></div>
              <div className="text-[10px] font-black text-slate-500 tracking-[0.3em] uppercase mb-4">匯率換算 (1:{rate})</div>
              <div className="flex items-center gap-5 mb-8">
                <input type="number" value={krw} onChange={e => setKrw(e.target.value)} placeholder="₩ 韓幣" className="w-1/2 bg-white/5 border border-white/10 p-5 rounded-[24px] text-xl font-black outline-none font-mono" />
                <div className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center border border-white/10"><i className="fas fa-arrow-right text-slate-600 text-xs"></i></div>
                <div className="w-1/2 text-right">
                  <div className="text-[10px] text-slate-500 font-bold mb-1">台幣估計</div>
                  <div className="text-3xl font-black text-emerald-400 font-mono tracking-tighter">NT$ {krw ? Math.round(parseInt(krw)/rate).toLocaleString() : 0}</div>
                </div>
              </div>
              <div className="pt-6 border-t border-white/5">
                <div className="text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest">退稅估計 (TAX REFUND)</div>
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-3"><input type="number" value={tax} onChange={e => setTax(e.target.value)} placeholder="消費金額" className="bg-white/5 border border-white/10 text-sm p-3 rounded-xl outline-none w-32 font-mono font-bold" /><span className="text-slate-500 text-xs font-bold">₩</span></div>
                  <div className="text-blue-400 font-black text-lg font-mono">+ ₩{calcTax(tax).toLocaleString()}</div>
                </div>
              </div>
            </div>
            <section>
              <div className="flex justify-between items-end mb-4 px-2"><h3 className="text-xl font-black text-slate-900">行李清單</h3><span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{checked.length} / {checklist.reduce((acc, g) => acc + g.items.length, 0)} 完成</span></div>
              <div className="bg-white p-4 rounded-[28px] shadow-sm border border-slate-200 mb-6 flex gap-3"><input value={newItem} onChange={e => setNewItem(e.target.value)} placeholder="需要帶什麼..." className="flex-1 bg-slate-50 p-4 rounded-2xl text-sm font-bold outline-none" /><button onClick={addItem} className="bg-slate-900 text-white px-6 rounded-2xl font-black text-sm active:scale-95 shadow-md">加入</button></div>
              <div className="space-y-4">
                {checklist.map((group, gi) => (
                  <div key={gi} className="bg-white p-7 rounded-[32px] border border-slate-100 shadow-sm overflow-hidden relative">
                    <h4 className="font-black text-slate-400 text-[10px] mb-5 uppercase tracking-[0.2em]">{group.title}</h4>
                    <div className="space-y-4">
                      {group.items.map((item, ii) => {
                        const isChecked = checked.includes(item);
                        return (
                          <div key={ii} onClick={() => toggle(item)} className="flex justify-between items-center py-1 cursor-pointer group">
                            <div className="flex items-center gap-4"><div className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all duration-300 ${isChecked ? 'bg-blue-600 border-blue-600 shadow-md scale-95' : 'border-slate-200 group-hover:border-slate-300'}`}>{isChecked && <i className="fas fa-check text-white text-[10px]"></i>}</div><span className={`text-sm font-bold transition-all duration-300 ${isChecked ? 'text-slate-300 line-through' : 'text-slate-700'}`}>{item}</span></div>
                            <button onClick={e => { e.stopPropagation(); removeItem(gi, ii); }} className="text-slate-200 hover:text-rose-500 p-2"><i className="fas fa-trash-alt text-sm"></i></button>
                          </div>
                        )
                      })}
                    </div>
                  </div>
                ))}
              </div>
            </section>
          </div>
        );
      };

      const Navigation = ({ activeTab, setActiveTab }) => {
        const navItems = [
          { id: 'itinerary', icon: 'fa-map-marked-alt', label: '行程' },
          { id: 'accounting', icon: 'fa-wallet', label: '記帳' },
          { id: 'translate', icon: 'fa-language', label: '翻譯' },
          { id: 'tools', icon: 'fa-suitcase', label: '工具' },
        ];
        return (
          <nav className="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-xl border-t border-slate-200/60 z-[100] transform-gpu shadow-[0_-4px_20px_rgba(0,0,0,0.03)] pb-[env(safe-area-inset-bottom)]">
            <div className="flex justify-around items-center h-16">
              {navItems.map((item) => (
                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center flex-1 h-full transition-all duration-300 ${activeTab === item.id ? 'text-blue-600 scale-105' : 'text-slate-400'}`}>
                  <i className={`fas ${item.icon} text-xl mb-1`}></i>
                  <span className="text-[10px] font-black tracking-tight">{item.label}</span>
                </button>
              ))}
            </div>
          </nav>
        );
      };

      const App = () => {
        const [activeTab, setActiveTab] = useState('itinerary');
        const [activeDate, setActiveDate] = useState(Object.keys(TRIP_DATA)[0]);
        useEffect(() => { window.scrollTo(0, 0); }, [activeDate, activeTab]);

        return (
          <div className="min-h-screen bg-[#F2FAFC] text-slate-800 font-sans pb-[calc(80px+env(safe-area-inset-bottom))]">
            {activeTab === 'itinerary' && (
              <>
                <Header activeDate={activeDate} setActiveDate={setActiveDate} />
                <main className="px-4 animate-fade-in transform-gpu"><ItineraryView activeDate={activeDate} /></main>
              </>
            )}
            {activeTab !== 'itinerary' && (
              <main className="px-4 pt-12 animate-fade-in transform-gpu">
                 {activeTab === 'accounting' && <AccountingView />}
                 {activeTab === 'translate' && <TranslationView />}
                 {activeTab === 'tools' && <ToolsView />}
              </main>
            )}
            <Navigation activeTab={activeTab} setActiveTab={setActiveTab} />
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
