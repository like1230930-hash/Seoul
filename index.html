<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seoul Ski Trip 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #F3F4F6; padding-bottom: 80px; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .weather-badge { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(4px); }
        .tag-must-eat { background-color: #FEF3C7; color: #D97706; }
        .tag-must-buy { background-color: #D1FAE5; color: #059669; }
        .tag-transport { background-color: #DBEAFE; color: #2563EB; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <div class="sticky top-0 z-50 bg-white shadow-sm">
        <div class="flex justify-between items-center p-4">
            <h1 class="text-xl font-bold text-gray-800">SEOUL 2025 ğŸ‡°ğŸ‡·</h1>
            <div class="text-xs text-gray-500" id="weather-header">é¦–çˆ¾ -2Â°C â˜€ï¸</div>
        </div>
        <div class="flex overflow-x-auto hide-scrollbar px-2 pb-2 space-x-2" id="date-nav">
            </div>
    </div>

    <div id="app-content" class="p-4 space-y-4">
        </div>

    <div class="fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around items-center py-3 z-50 text-xs text-gray-500 pb-safe">
        <button onclick="switchTab('itinerary')" class="flex flex-col items-center space-y-1 w-full text-blue-600 active-tab" id="btn-itinerary">
            <i class="fas fa-map-marked-alt text-lg"></i>
            <span>è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('accounting')" class="flex flex-col items-center space-y-1 w-full" id="btn-accounting">
            <i class="fas fa-calculator text-lg"></i>
            <span>è¨˜å¸³</span>
        </button>
        <button onclick="switchTab('tools')" class="flex flex-col items-center space-y-1 w-full" id="btn-tools">
            <i class="fas fa-suitcase text-lg"></i>
            <span>è³‡è¨Š</span>
        </button>
    </div>

    <script>
        // --- DATA ---
        const tripData = {
            "2025-12-21": [
                { type: "transport", time: "18:15", title: "é£›å¾€é¦–çˆ¾", subtitle: "Scoot TR896 (T1)", desc: "é è¨ˆæŠµé”ä»å· 21:45ã€‚è¡Œæç›´æ›ã€‚", tags: ["é£›è¡Œ 2h30m"] },
                { type: "transport", time: "22:30", title: "å‰å¾€å¸‚å€", subtitle: "æ©Ÿå ´å¿«ç·š AREX / å·´å£«", desc: "å»ºè­°æ­ä¹˜ AREX ç›´é”é¦–çˆ¾ç«™è½‰ 1 è™Ÿç·šè‡³æ¸…æ¶¼é‡Œï¼Œæˆ–æ­ä¹˜æ©Ÿå ´å·´å£« 6002ã€‚", highlight: "æœ«ç­è»Šæ³¨æ„ï¼šAREXç›´é”è»Šæœ«ç­ç´„ 22:48", subway: "ICN âœ é¦–çˆ¾ç«™ (AREX) âœ æ¸…æ¶¼é‡Œç«™ (1è™Ÿç·š)" },
                { type: "hotel", time: "23:50", title: "å…¥ä½é£¯åº—", subtitle: "Hotel The Designers Cheongnyangni", desc: "Agoda è¨‚å–®: 1633690442ã€‚ä½æ–¼æ¸…æ¶¼é‡Œç«™é™„è¿‘ã€‚", tags: ["é‡è¦ä»£è™Ÿ"] },
                { type: "food", time: "00:00", title: "æ·±å¤œé£Ÿå ‚", subtitle: "æ¸…æ¶¼é‡Œç«™å‘¨é‚Š", desc: "è»Šç«™é™„è¿‘æœ‰è¨±å¤šå¸ƒå¸³é¦¬è»Š(è·¯é‚Šæ”¤)ã€‚", tags: ["å¿…åƒ: é­šæ¿æ¹¯", "å¿…åƒ: è¾£ç‚’å¹´ç³•"] }
            ],
            "2025-12-22": [
                { type: "transport", time: "07:00", title: "é›†åˆå‡ºç™¼", subtitle: "æ¸…æ¶¼é‡Œç«è»Šç«™ Olive Young å‰", desc: "åˆ‡å‹¿é²åˆ°ï¼07:25 ç«è»Šæº–æ™‚ç™¼è»Šã€‚", tags: ["æ—©èµ·æ³¨æ„"] },
                { type: "activity", time: "11:05", title: "æŠµé” High 1 æ»‘é›ªå ´", subtitle: "æ±ŸåŸé“", desc: "æŒ‘é¸é›ªè¡£ã€é ˜å–è£å‚™ã€‚High 1 æ˜¯éŸ“åœ‹é›ªè³ªæœ€å¥½çš„é›ªå ´ä¹‹ä¸€ã€‚", tags: ["æ”»ç•¥: å…ˆè©¦ç©¿å°ºå¯¸", "ç¾é‡‘ä»˜å°¾æ¬¾"] },
                { type: "activity", time: "12:50", title: "æ»‘é›ªèª²ç¨‹ Day 1", subtitle: "ä¸‹åˆå ´", desc: "åˆå­¸è€…åŸºç¤æ•™å­¸ã€‚è¨˜å¾—éš¨æ™‚è£œå……æ°´åˆ†ã€‚", tags: ["æ³¨æ„ä¿æš–"] },
                { type: "hotel", time: "16:30", title: "Ski House å…¥ä½", subtitle: "ä¼‘æ¯æ™‚é–“", desc: "è‡ªç”±æ´»å‹•ã€‚", tags: [] },
                { type: "activity", time: "18:30", title: "å¤œé–“æ»‘é›ª", subtitle: "Night Ski", desc: "é«”é©—èˆ‡ç™½å¤©å®Œå…¨ä¸åŒçš„æ»‘é›ªæ°›åœã€‚", tags: ["æ‹ç…§æœ€ç¾æ™‚æ®µ"] }
            ],
            "2025-12-23": [
                { type: "activity", time: "09:00", title: "æ»‘é›ªèª²ç¨‹ Day 2", subtitle: "ä¸Šåˆå ´", desc: "é€²éšæŠ€å·§ç·´ç¿’ã€‚12:00 çµæŸèª²ç¨‹ã€‚", tags: [] },
                { type: "activity", time: "13:00", title: "è‡ªç”±ç·´ç¿’", subtitle: "Free Time", desc: "äº«å— High 1 çš„è¶…é•·æ»‘é›ªé“ã€‚ä¹Ÿå¯ä»¥å»æ­ä¹˜è§€å…‰çºœè»Šã€‚", tags: ["å¿…å»: å±±é ‚å’–å•¡å»³"] },
                { type: "food", time: "18:00", title: "æ™šé¤æ™‚å…‰", subtitle: "åº¦å‡æ‘å…§ / é™„è¿‘", desc: "å¯ä»¥å˜—è©¦éŸ“å¼çƒ¤è‚‰è£œå……é«”åŠ›ã€‚", tags: ["å¿…åƒ: éŸ“ç‰›", "å¿…é»: å¤§é†¬æ¹¯"] },
                { type: "activity", time: "18:30", title: "å¤œé–“æ»‘é›ª", subtitle: "Night Ski", desc: "æŠŠæ¡æœ€å¾Œä¸€æ™šçš„æ»‘é›ªæ™‚å…‰ã€‚", tags: [] }
            ],
            "2025-12-24": [
                { type: "other", time: "08:20", title: "é€€æˆ¿", subtitle: "Mountain Ski House", desc: "è¡Œææ•´ç†å¥½ï¼Œæº–å‚™æœ€å¾ŒåŠå¤©çš„æ»‘é›ªã€‚", tags: ["é€€æˆ¿"] },
                { type: "activity", time: "09:00", title: "æ»‘é›ªèª²ç¨‹ Day 3", subtitle: "æœ€çµ‚å ´", desc: "äº«å—æœ€å¾Œçš„é›ªåœ°æ™‚å…‰ã€‚", tags: [] },
                { type: "transport", time: "15:45", title: "æ­¸é‚„è£å‚™ & é›†åˆ", subtitle: "Mountain Ski House å‰", desc: "16:20 å·´å£«æº–æ™‚ç™¼è»Šå›é¦–çˆ¾ã€‚", tags: ["æº–æ™‚é›†åˆ"] },
                { type: "transport", time: "19:45", title: "æŠµé”é¦–çˆ¾", subtitle: "æ˜æ´ç«™ / æ–°æ‘ç«™", desc: "å»ºè­°åœ¨æ˜æ´ä¸‹è»Šï¼Œæ™šé¤é¸æ“‡å¤šä¸”æ›éŒ¢æ–¹ä¾¿ã€‚", subway: "å¯è½‰ä¹˜ 4è™Ÿç·š (æ˜æ´) æˆ– 2è™Ÿç·š (æ–°æ‘)" },
                { type: "food", time: "20:30", title: "è–èª•å¤œæ™šé¤", subtitle: "æ˜æ´/æ–°æ‘", desc: "å¹³å®‰å¤œé¦–çˆ¾äººæ½®çœ¾å¤šï¼Œå»ºè­°ææ—©æ‰¾é¤å»³ã€‚", tags: ["å¿…åƒ: ä¸€éš»é›", "å¿…åƒ: æ˜¥å·è¾£ç‚’é›"] }
            ],
            "2025-12-25": [
                { type: "activity", time: "10:00", title: "è–èª•ç¯€ Free Time", subtitle: "é¦–çˆ¾å¸‚å€", desc: "å¾…å®‰æ’ã€‚å»ºè­°ï¼šæ±çŸ£å³¶ç¾ä»£ç™¾è²¨çœ‹è–èª•è£é£¾ï¼Œæˆ–å¼˜å¤§é€›è¡—ã€‚", tags: ["å¾…å®‰æ’"] }
            ],
             "2025-12-26": [
                { type: "activity", time: "10:00", title: "é¦–çˆ¾ Free Time", subtitle: "é¦–çˆ¾å¸‚å€", desc: "å¾…å®‰æ’ã€‚å»ºè­°ï¼šæ™¯ç¦å®®éŸ“æœé«”é©—ï¼ŒåŒ—æ‘éŸ“å±‹æ‘ã€‚", tags: ["å¾…å®‰æ’"] }
            ],
             "2025-12-27": [
                { type: "activity", time: "10:00", title: "æœ€å¾Œè¡åˆº", subtitle: "è³¼ç‰©è¡Œç¨‹", desc: "æ¨‚å¤©è¶…å¸‚æ¡è²·ä¼´æ‰‹ç¦® (æµ·è‹”, æ³¡éºµ, é›¶é£Ÿ)ã€‚", tags: ["å¿…è²·: HBAFæä»æœ"] },
                { type: "transport", time: "20:00", title: "å‰å¾€æ©Ÿå ´", subtitle: "AREX / å·´å£«", desc: "èˆªç­ 23:00 èµ·é£›ï¼Œå»ºè­° 20:30 å‰æŠµé”æ©Ÿå ´æ«ƒæª¯ã€‚", subway: "é¦–çˆ¾ç«™ âœ ICN (AREX ç›´é”)" },
                { type: "transport", time: "23:00", title: "é£›å¾€å°åŒ—", subtitle: "Scoot TR897", desc: "é è¨ˆ 12/28 00:45 æŠµé”æ¡ƒåœ’ T1ã€‚è¡Œæ 50kgã€‚", tags: ["å›ç¨‹"] }
            ],
        };

        const toolsData = {
            flight: [
                { dir: "å»ç¨‹", code: "TR896", date: "12/21 (æ—¥)", time: "18:15 - 21:45", airport: "TPE T1 -> ICN", bag: "35kg" },
                { dir: "å›ç¨‹", code: "TR897", date: "12/27 (å…­)", time: "23:00 - 00:45(+1)", airport: "ICN -> TPE T1", bag: "50kg" }
            ],
            stay: [
                { name: "The Designers Cheongnyangni", date: "12/21-12/22", code: "Agoda: 1633690442", note: "æ¸…æ¶¼é‡Œç«™" },
                { name: "High 1 Ski Resort", date: "12/22-12/24", code: "Tour Booking", note: "æ»‘é›ªåº¦å‡æ‘" }
            ],
            emergency: [
                { name: "å ±è­¦", number: "112" },
                { name: "ç«è­¦/æ€¥æ•‘", number: "119" },
                { name: "éŸ“åœ‹æ—…éŠè«®è©¢ç†±ç·š", number: "1330 (æœ‰ä¸­æ–‡)" },
                { name: "å¤–äº¤éƒ¨æ€¥é›£æ•‘åŠ©", number: "+82-10-9080-2761" }
            ]
        };

        let expenses = JSON.parse(localStorage.getItem('skiTripExpenses')) || [];
        const exchangeRate = 0.023; // KRW to TWD rough estimate
        let activeDate = "2025-12-21";
        let activeTab = "itinerary";

        // --- RENDER FUNCTIONS ---

        function renderDateNav() {
            const nav = document.getElementById('date-nav');
            nav.innerHTML = '';
            Object.keys(tripData).forEach(date => {
                const day = new Date(date).getDate();
                const isActive = date === activeDate;
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center transition-all ${isActive ? 'bg-blue-600 text-white shadow-lg transform scale-105' : 'bg-white text-gray-400'}`;
                btn.onclick = () => { activeDate = date; renderItinerary(); renderDateNav(); };
                btn.innerHTML = `<span class="text-xs font-bold">12/</span><span class="text-xl font-bold">${day}</span>`;
                nav.appendChild(btn);
            });
        }

        function renderItinerary() {
            const container = document.getElementById('app-content');
            container.innerHTML = '';
            const dayData = tripData[activeDate];
            
            // Weather Placeholder (Simulated logic based on date)
            const weatherDiv = document.createElement('div');
            weatherDiv.className = "bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl p-4 text-white shadow-md mb-4 flex justify-between items-center";
            weatherDiv.innerHTML = `<div><div class="text-sm opacity-90">æœ¬æ—¥å¤©æ°£é å ±</div><div class="text-2xl font-bold">-2Â°C ~ 4Â°C</div></div><i class="fas fa-snowflake text-4xl opacity-80"></i>`;
            container.appendChild(weatherDiv);

            if(!dayData) {
                container.innerHTML += `<div class="text-center text-gray-400 mt-10">å°šç„¡è¡Œç¨‹å®‰æ’</div>`;
                return;
            }

            dayData.forEach(item => {
                let icon = 'fa-circle';
                let colorClass = 'border-l-4 border-gray-300';
                if(item.type === 'transport') { icon = 'fa-train'; colorClass = 'border-l-4 border-blue-500'; }
                if(item.type === 'food') { icon = 'fa-utensils'; colorClass = 'border-l-4 border-orange-400'; }
                if(item.type === 'activity') { icon = 'fa-person-skiing'; colorClass = 'border-l-4 border-cyan-500'; }
                if(item.type === 'hotel') { icon = 'fa-bed'; colorClass = 'border-l-4 border-purple-500'; }

                let tagsHtml = item.tags ? item.tags.map(tag => {
                    let style = "bg-gray-100 text-gray-600";
                    if(tag.includes("å¿…åƒ") || tag.includes("å¿…é»")) style = "tag-must-eat";
                    if(tag.includes("å¿…è²·")) style = "tag-must-buy";
                    if(tag.includes("æ³¨æ„") || tag.includes("æ”»ç•¥")) style = "bg-red-50 text-red-600";
                    return `<span class="text-xs px-2 py-1 rounded-full ${style} mr-1 mb-1 inline-block">${tag}</span>`;
                }).join('') : '';

                let subwayHtml = item.subway ? `<div class="mt-2 p-2 bg-gray-50 rounded text-xs text-gray-600 flex items-center"><i class="fas fa-subway mr-2 text-blue-800"></i> ${item.subway}</div>` : '';

                const card = document.createElement('div');
                card.className = `bg-white rounded-xl p-4 card-shadow mb-3 ${colorClass}`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-lg font-bold text-gray-800">${item.time}</span>
                        <i class="fas ${icon} text-gray-300"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900 leading-tight">${item.title}</h3>
                    <div class="text-sm text-blue-600 font-medium mb-1">${item.subtitle}</div>
                    <p class="text-sm text-gray-500 mb-2 leading-relaxed">${item.desc}</p>
                    ${subwayHtml}
                    <div class="mt-2 flex flex-wrap">${tagsHtml}</div>
                `;
                container.appendChild(card);
            });
        }

        function renderAccounting() {
            const container = document.getElementById('app-content');
            
            // Calculate Splits
            let total = 0;
            let paidByUser = 0;
            let paidByPartner = 0; // Cup/Beigen

            expenses.forEach(ex => {
                total += parseFloat(ex.amount);
                if(ex.payer === 'me') paidByUser += parseFloat(ex.amount);
                else paidByPartner += parseFloat(ex.amount);
            });

            // If split equally
            const shouldPay = total / 2;
            const diff = paidByUser - shouldPay; // If positive, Partner owes User. If negative, User owes Partner.
            let resultText = diff > 0 ? `æ¯èŒ› éœ€çµ¦ä½ ` : `ä½ éœ€çµ¦ æ¯èŒ›`;
            let resultAmount = Math.abs(diff).toLocaleString();

            let listHtml = expenses.slice().reverse().map((ex, index) => `
                <div class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center mb-2 border-l-4 ${ex.payer === 'me' ? 'border-blue-400' : 'border-green-400'}">
                    <div>
                        <div class="font-bold text-gray-800">${ex.item}</div>
                        <div class="text-xs text-gray-400">${ex.date} | ${ex.payer === 'me' ? 'æˆ‘' : 'æ¯èŒ›'} å…ˆä»˜</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold">â‚©${parseInt(ex.amount).toLocaleString()}</div>
                        <div class="text-xs text-gray-400">â‰ˆ NT$${Math.round(ex.amount * exchangeRate).toLocaleString()}</div>
                    </div>
                    <button onclick="deleteExpense(${index})" class="ml-3 text-red-300"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="bg-gradient-to-br from-indigo-600 to-blue-700 rounded-2xl p-5 text-white shadow-lg mb-6">
                    <div class="text-sm opacity-75 mb-1">ç¸½æ”¯å‡º (KRW)</div>
                    <div class="text-3xl font-bold mb-4">â‚©${total.toLocaleString()}</div>
                    <div class="flex justify-between text-sm bg-white/10 p-3 rounded-lg">
                        <div>
                            <div class="opacity-75">åˆ†å¸³çµæœ</div>
                            <div class="font-bold text-lg text-yellow-300">${resultText} <span class="text-xl">â‚©${resultAmount}</span></div>
                        </div>
                        <div class="text-right opacity-75 text-xs">
                            æˆ‘ä»˜: â‚©${paidByUser.toLocaleString()}<br>
                            æ¯èŒ›ä»˜: â‚©${paidByPartner.toLocaleString()}
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
                    <h3 class="font-bold text-gray-700 mb-3">æ–°å¢è¨˜å¸³</h3>
                    <div class="grid grid-cols-1 gap-3">
                        <input type="text" id="ex-item" placeholder="é …ç›® (ä¾‹å¦‚: æ™šé¤)" class="bg-gray-50 border border-gray-200 rounded p-2 w-full">
                        <div class="flex gap-2">
                            <input type="number" id="ex-amount" placeholder="éŸ“å¹£é‡‘é¡" class="bg-gray-50 border border-gray-200 rounded p-2 w-full">
                            <select id="ex-payer" class="bg-gray-50 border border-gray-200 rounded p-2">
                                <option value="me">æˆ‘å…ˆä»˜</option>
                                <option value="partner">æ¯èŒ›å…ˆä»˜</option>
                            </select>
                        </div>
                        <div id="ex-twd-hint" class="text-xs text-right text-gray-400 h-4"></div>
                        <button onclick="addExpense()" class="bg-blue-600 text-white rounded p-3 font-bold active:bg-blue-700 transition">æ–°å¢ç´€éŒ„</button>
                    </div>
                </div>

                <div class="mb-20">
                    <h3 class="font-bold text-gray-700 mb-3 ml-1">æœ€è¿‘ç´€éŒ„</h3>
                    ${listHtml}
                </div>
            `;

            // Add listener for instant currency conversion hint
            document.getElementById('ex-amount').addEventListener('input', (e) => {
                const val = e.target.value;
                if(val) {
                    document.getElementById('ex-twd-hint').innerText = `â‰ˆ NT$${Math.round(val * exchangeRate).toLocaleString()}`;
                } else {
                    document.getElementById('ex-twd-hint').innerText = '';
                }
            });
        }

        function addExpense() {
            const item = document.getElementById('ex-item').value;
            const amount = document.getElementById('ex-amount').value;
            const payer = document.getElementById('ex-payer').value;

            if(!item || !amount) return alert("è«‹è¼¸å…¥é …ç›®å’Œé‡‘é¡");

            expenses.push({
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                item,
                amount,
                payer
            });
            localStorage.setItem('skiTripExpenses', JSON.stringify(expenses));
            renderAccounting();
        }

        function deleteExpense(index) {
            // Because we reversed the display list, we need to find the correct index in the original array
            // Actually, simpler to just reverse the copy for display, but here let's just use the ID if we were doing it properly.
            // For this simple version, let's just reload from local storage minus the one we clicked.
            // NOTE: The index passed here is from the reversed array.
            const realIndex = expenses.length - 1 - index;
            expenses.splice(realIndex, 1);
            localStorage.setItem('skiTripExpenses', JSON.stringify(expenses));
            renderAccounting();
        }

        function renderTools() {
            const container = document.getElementById('app-content');
            
            const flightHtml = toolsData.flight.map(f => `
                <div class="bg-white rounded-lg p-3 mb-2 border-l-4 border-indigo-500 shadow-sm">
                    <div class="flex justify-between font-bold text-gray-800">
                        <span>${f.dir}</span>
                        <span>${f.code}</span>
                    </div>
                    <div class="text-sm text-gray-600 mt-1">${f.date} | ${f.time}</div>
                    <div class="text-xs text-gray-400 mt-1">${f.airport} | è¡Œæ: ${f.bag}</div>
                </div>
            `).join('');

            const stayHtml = toolsData.stay.map(s => `
                <div class="bg-white rounded-lg p-3 mb-2 border-l-4 border-purple-500 shadow-sm">
                    <div class="font-bold text-gray-800">${s.name}</div>
                    <div class="text-sm text-gray-600 mt-1">${s.date}</div>
                    <div class="mt-2 inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded select-all font-mono">${s.code}</div>
                </div>
            `).join('');

             const emergencyHtml = toolsData.emergency.map(e => `
                <a href="tel:${e.number}" class="flex justify-between items-center bg-red-50 p-3 rounded-lg mb-2 border border-red-100">
                    <span class="text-red-800 font-medium">${e.name}</span>
                    <span class="text-red-600 font-bold"><i class="fas fa-phone-alt mr-1"></i> ${e.number}</span>
                </a>
            `).join('');

            container.innerHTML = `
                <h3 class="font-bold text-gray-700 mb-2 ml-1">èˆªç­è³‡è¨Š</h3>
                ${flightHtml}
                
                <h3 class="font-bold text-gray-700 mb-2 ml-1 mt-6">ä½å®¿è³‡è¨Š</h3>
                ${stayHtml}

                <h3 class="font-bold text-gray-700 mb-2 ml-1 mt-6">ç·Šæ€¥è¯çµ¡</h3>
                ${emergencyHtml}
            `;
        }

        function switchTab(tab) {
            activeTab = tab;
            // Update UI
            ['itinerary', 'accounting', 'tools'].forEach(t => {
                const btn = document.getElementById(`btn-${t}`);
                if(t === tab) {
                    btn.classList.add('text-blue-600', 'active-tab');
                    btn.classList.remove('text-gray-500');
                } else {
                    btn.classList.remove('text-blue-600', 'active-tab');
                    btn.classList.add('text-gray-500');
                }
            });

            // Update Header Visibility
            if(tab === 'itinerary') {
                document.getElementById('date-nav').style.display = 'flex';
                document.getElementById('weather-header').style.visibility = 'visible';
                renderItinerary();
            } else {
                document.getElementById('date-nav').style.display = 'none';
                document.getElementById('weather-header').style.visibility = 'hidden';
                if(tab === 'accounting') renderAccounting();
                if(tab === 'tools') renderTools();
            }
        }

        // Init
        renderDateNav();
        renderItinerary();

    </script>
</body>
</html>
